<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“åŒæ­¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .product-list {
            margin-top: 2rem;
        }
        .product-item {
            background: #f8f9fa;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.5rem;
        }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .timestamp {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ äº§å“åŒæ­¥æµ‹è¯•é¡µé¢</h1>
        
        <div class="status info">
            <strong>æµ‹è¯•è¯´æ˜ï¼š</strong> æ­¤é¡µé¢ç”¨äºæµ‹è¯•ç®¡ç†åå°ä¸å‰ç«¯çš„äº§å“æ•°æ®åŒæ­¥åŠŸèƒ½
        </div>
        
        <div class="status" id="syncStatus">
            æ­£åœ¨æ£€æŸ¥äº§å“æ•°æ®...
        </div>
        
        <div>
            <button class="btn" onclick="refreshProducts()">ğŸ”„ åˆ·æ–°äº§å“åˆ—è¡¨</button>
            <button class="btn btn-success" onclick="addTestProduct()">â• æ·»åŠ æµ‹è¯•äº§å“</button>
            <button class="btn btn-danger" onclick="clearTestProducts()">ğŸ—‘ï¸ æ¸…é™¤æµ‹è¯•äº§å“</button>
        </div>
        
        <div class="product-list">
            <h3>å½“å‰äº§å“åˆ—è¡¨ï¼š</h3>
            <div id="productList">
                åŠ è½½ä¸­...
            </div>
        </div>
        
        <div class="status info">
            <strong>æµ‹è¯•æ­¥éª¤ï¼š</strong><br>
            1. ç‚¹å‡»"æ·»åŠ æµ‹è¯•äº§å“"æ·»åŠ ä¸€ä¸ªæµ‹è¯•äº§å“<br>
            2. æ‰“å¼€ç®¡ç†åå° <a href="admin.html" target="_blank">admin.html</a><br>
            3. åœ¨ç®¡ç†åå°æ·»åŠ /ç¼–è¾‘äº§å“<br>
            4. è¿”å›æ­¤é¡µé¢æŸ¥çœ‹æ˜¯å¦å®æ—¶æ›´æ–°<br>
            5. æ‰“å¼€ä¸»é¡µé¢ <a href="index.html" target="_blank">index.html</a> æŸ¥çœ‹äº§å“æ˜¯å¦åŒæ­¥
        </div>
    </div>

    <script>
        let products = [];
        let lastUpdateTime = null;

        // åŠ è½½äº§å“æ•°æ®
        function loadProducts() {
            const savedProducts = localStorage.getItem('adminProducts');
            if (savedProducts) {
                products = JSON.parse(savedProducts);
                lastUpdateTime = new Date().toLocaleTimeString();
                updateSyncStatus('success', `äº§å“æ•°æ®å·²åŠ è½½ (${products.length} ä¸ªäº§å“) - æ›´æ–°æ—¶é—´: ${lastUpdateTime}`);
            } else {
                products = [];
                updateSyncStatus('warning', 'æœªæ‰¾åˆ°äº§å“æ•°æ®');
            }
            renderProducts();
        }

        // æ›´æ–°åŒæ­¥çŠ¶æ€
        function updateSyncStatus(type, message) {
            const status = document.getElementById('syncStatus');
            status.className = `status ${type}`;
            status.innerHTML = `<strong>çŠ¶æ€ï¼š</strong> ${message}`;
        }

        // æ¸²æŸ“äº§å“åˆ—è¡¨
        function renderProducts() {
            const productList = document.getElementById('productList');
            if (products.length === 0) {
                productList.innerHTML = '<div class="status warning">æš‚æ— äº§å“æ•°æ®</div>';
                return;
            }

            let html = '';
            products.forEach(product => {
                html += `
                    <div class="product-item">
                        <strong>${product.title}</strong> - Â¥${product.price.toLocaleString()}<br>
                        <small>${product.description}</small>
                        <div class="timestamp">ID: ${product.id} | ç±»åˆ«: ${product.category}</div>
                    </div>
                `;
            });
            productList.innerHTML = html;
        }

        // åˆ·æ–°äº§å“
        function refreshProducts() {
            loadProducts();
        }

        // æ·»åŠ æµ‹è¯•äº§å“
        function addTestProduct() {
            const testProduct = {
                id: Date.now(),
                title: `æµ‹è¯•äº§å“ ${new Date().toLocaleTimeString()}`,
                description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•äº§å“ï¼Œç”¨äºéªŒè¯åŒæ­¥åŠŸèƒ½',
                price: Math.floor(Math.random() * 1000) + 100,
                image: 'ğŸ§ª',
                category: 'æµ‹è¯•äº§å“',
                stock: 10,
                createdAt: new Date().toISOString()
            };
            
            products.push(testProduct);
            localStorage.setItem('adminProducts', JSON.stringify(products));
            
            // è§¦å‘åŒæ­¥äº‹ä»¶
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'adminProducts',
                newValue: JSON.stringify(products)
            }));
            
            loadProducts();
            updateSyncStatus('success', 'æµ‹è¯•äº§å“å·²æ·»åŠ å¹¶åŒæ­¥');
        }

        // æ¸…é™¤æµ‹è¯•äº§å“
        function clearTestProducts() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•äº§å“å—ï¼Ÿ')) {
                products = products.filter(p => p.category !== 'æµ‹è¯•äº§å“');
                localStorage.setItem('adminProducts', JSON.stringify(products));
                
                // è§¦å‘åŒæ­¥äº‹ä»¶
                window.dispatchEvent(new StorageEvent('storage', {
                    key: 'adminProducts',
                    newValue: JSON.stringify(products)
                }));
                
                loadProducts();
                updateSyncStatus('info', 'æµ‹è¯•äº§å“å·²æ¸…é™¤');
            }
        }

        // ç›‘å¬Local Storageå˜åŒ–
        window.addEventListener('storage', function(e) {
            if (e.key === 'adminProducts') {
                updateSyncStatus('info', 'æ£€æµ‹åˆ°æ•°æ®å˜åŒ–ï¼Œæ­£åœ¨æ›´æ–°...');
                setTimeout(() => {
                    loadProducts();
                }, 500);
            }
        });

        // å®šæœŸæ£€æŸ¥æ•°æ®å˜åŒ–
        setInterval(() => {
            const savedProducts = localStorage.getItem('adminProducts');
            if (savedProducts) {
                const currentProducts = JSON.parse(savedProducts);
                if (JSON.stringify(currentProducts) !== JSON.stringify(products)) {
                    updateSyncStatus('info', 'æ£€æµ‹åˆ°æ•°æ®å˜åŒ–ï¼Œæ­£åœ¨æ›´æ–°...');
                    loadProducts();
                }
            }
        }, 2000);

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
        });
    </script>
</body>
</html>
